<div class="container">
  <div class="flex justify-between">
    <h3 class="m-0">AI Assistant</h3>
    <div class="status">
      <span [class]="getStatusClass()">{{ connectionStatus | titlecase }}</span>
      <span *ngIf="isPlaying" class="playing-indicator">üéµ Playing</span>
    </div>
  </div>

  <!-- Audio Error Display -->
  <div *ngIf="audioError" class="audio-error">
    <span>‚ö†Ô∏è {{ audioError }}</span>
    <button (click)="clearAudioError()" class="clear-error-btn">√ó</button>
  </div>

  <div class="controls">
    <button (click)="startSession()" 
            [disabled]="connectionStatus !== 'connected'" 
            class="btn btn-primary">
      Start Session
    </button>

    <button (click)="startRecording()" 
            [disabled]="connectionStatus !== 'session-active' || isRecording || !!audioError"
            class="btn btn-success"
            [class.recording]="isRecording">
      {{ getRecordingButtonText() }}
    </button>

    <button (click)="stopRecording()" 
            [disabled]="!isRecording" 
            class="btn btn-warning">
      Stop Recording
    </button>

    <button (click)="testTextMessage()" 
            [disabled]="connectionStatus !== 'session-active'" 
            class="btn btn-info">
      Test Message
    </button>

    <button (click)="endSession()" 
            [disabled]="connectionStatus !== 'session-active'" 
            class="btn btn-danger">
      End Session
    </button>
  </div>

  <!-- Audio Status Indicators -->
  <div class="audio-status" *ngIf="connectionStatus === 'session-active'">
    <div class="status-item" [class.active]="isRecording">
      <span class="indicator recording"></span>
      {{ isRecording ? 'Recording' : 'Not Recording' }}
    </div>
    
    <div class="status-item" [class.active]="isPlaying">
      <span class="indicator playing"></span>
      {{ isPlaying ? 'Playing Audio' : 'Audio Ready' }}
    </div>
  </div>

  <div class="conversation">
    <h3>Conversation</h3>
    <div class="messages">
      <div *ngFor="let message of conversationHistory;" 
           [class]="'message message-' + message.role">
        <strong>{{ message.role | titlecase }}:</strong>
        <!-- <markdown [data]="message.content"></markdown> -->
        <p>{{ message.content }}</p>
        <small>{{ message.timestamp | date:'short' }}</small>
      </div>
      
      <!-- Empty state -->
      <div *ngIf="conversationHistory.length === 0" class="empty-conversation">
        <p>Start a session and begin recording to chat with the AI assistant.</p>
      </div>
    </div>
  </div>

  <footer class="flex justify-between">
    <div class="summary-status">
      <p *ngIf="summary().extracted_data" class="summary-ready">
        ‚úÖ Summary is ready
      </p>
      <p *ngIf="!summary().extracted_data && conversationHistory.length > 0" class="summary-pending">
        üîÑ Waiting for clinical summary...
      </p>
    </div>
    <!-- <p-button 
      [severity]="summary().extracted_data ? null : 'danger'" 
      label="Close" 
      (onClick)="closeChat()" /> -->
      <button (click)="closeChat()">Reset</button>
  </footer>
</div>
